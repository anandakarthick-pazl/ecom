// Debug version of stock notifications - simpler and more robust
console.log('Stock Notification Debug System Loading...');\n\n// Simple notification modal function\nfunction showStockNotificationModal(productId, productName) {\n    console.log('Showing notification modal for product:', productId, productName);\n    \n    // Remove any existing modal\n    const existingModal = document.getElementById('stockNotificationModal');\n    if (existingModal) {\n        existingModal.remove();\n    }\n    \n    const modalHtml = `\n    <div class=\"modal fade\" id=\"stockNotificationModal\" tabindex=\"-1\" aria-labelledby=\"stockNotificationModalLabel\" aria-hidden=\"true\">\n        <div class=\"modal-dialog modal-dialog-centered\">\n            <div class=\"modal-content\">\n                <div class=\"modal-header\">\n                    <h5 class=\"modal-title\" id=\"stockNotificationModalLabel\">\n                        ðŸ”” Get Notified When Available\n                    </h5>\n                    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\n                </div>\n                <div class=\"modal-body\">\n                    <div class=\"text-center mb-3\">\n                        <h6>\"${productName}\" is currently out of stock</h6>\n                        <p class=\"text-muted small\">We'll notify you when it's back!</p>\n                    </div>\n                    \n                    <form id=\"stockNotificationForm\">\n                        <input type=\"hidden\" name=\"product_id\" value=\"${productId}\">\n                        \n                        <div class=\"mb-3\">\n                            <label class=\"form-label\">Your Name (Optional)</label>\n                            <input type=\"text\" class=\"form-control\" name=\"customer_name\" placeholder=\"John Doe\">\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label class=\"form-label\">Email Address</label>\n                            <input type=\"email\" class=\"form-control\" name=\"customer_email\" placeholder=\"john@example.com\" required>\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label class=\"form-label\">Mobile Number (Optional)</label>\n                            <input type=\"tel\" class=\"form-control\" name=\"customer_mobile\" placeholder=\"9876543210\">\n                        </div>\n                        \n                        <div class=\"mb-3\">\n                            <label class=\"form-label\">Notification Method</label>\n                            <div>\n                                <input type=\"radio\" class=\"form-check-input\" name=\"notification_type\" value=\"both\" id=\"notify_both\" checked>\n                                <label class=\"form-check-label\" for=\"notify_both\">ðŸ“§ðŸ“± Email & WhatsApp</label>\n                            </div>\n                            <div>\n                                <input type=\"radio\" class=\"form-check-input\" name=\"notification_type\" value=\"email\" id=\"notify_email\">\n                                <label class=\"form-check-label\" for=\"notify_email\">ðŸ“§ Email Only</label>\n                            </div>\n                            <div>\n                                <input type=\"radio\" class=\"form-check-input\" name=\"notification_type\" value=\"whatsapp\" id=\"notify_whatsapp\">\n                                <label class=\"form-check-label\" for=\"notify_whatsapp\">ðŸ“± WhatsApp Only</label>\n                            </div>\n                        </div>\n                    </form>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cancel</button>\n                    <button type=\"button\" class=\"btn btn-primary\" onclick=\"submitNotificationForm()\">Set Up Notification</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    `;\n    \n    // Add modal to page\n    document.body.insertAdjacentHTML('beforeend', modalHtml);\n    \n    // Show modal\n    try {\n        const modal = new bootstrap.Modal(document.getElementById('stockNotificationModal'));\n        modal.show();\n        console.log('Modal should be visible now');\n    } catch (error) {\n        console.error('Error showing modal:', error);\n        alert('Modal system not working. Please check if Bootstrap 5 is loaded.');\n    }\n}\n\n// Submit notification form\nfunction submitNotificationForm() {\n    console.log('Submitting notification form...');\n    \n    const form = document.getElementById('stockNotificationForm');\n    const formData = new FormData(form);\n    const data = Object.fromEntries(formData);\n    \n    // Basic validation\n    if (!data.customer_email) {\n        alert('Please enter your email address');\n        return;\n    }\n    \n    // Get CSRF token\n    const csrfToken = document.querySelector('meta[name=\"csrf-token\"]')?.getAttribute('content');\n    if (!csrfToken) {\n        alert('CSRF token not found. Please refresh the page.');\n        return;\n    }\n    \n    console.log('Sending data:', data);\n    \n    // Show loading\n    const submitBtn = document.querySelector('#stockNotificationModal .btn-primary');\n    const originalText = submitBtn.textContent;\n    submitBtn.textContent = 'Setting up...';\n    submitBtn.disabled = true;\n    \n    // Submit\n    fetch('/stock-notifications/subscribe', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n            'X-CSRF-TOKEN': csrfToken,\n            'Accept': 'application/json'\n        },\n        body: JSON.stringify(data)\n    })\n    .then(response => {\n        console.log('Response status:', response.status);\n        return response.json();\n    })\n    .then(result => {\n        console.log('Result:', result);\n        \n        if (result.success) {\n            alert('âœ… ' + result.message);\n            const modal = bootstrap.Modal.getInstance(document.getElementById('stockNotificationModal'));\n            modal.hide();\n        } else {\n            alert('âŒ ' + result.message);\n        }\n    })\n    .catch(error => {\n        console.error('Error:', error);\n        alert('âŒ Network error. Please try again.');\n    })\n    .finally(() => {\n        submitBtn.textContent = originalText;\n        submitBtn.disabled = false;\n    });\n}\n\n// Test function\nfunction testNotificationSystem() {\n    console.log('Testing notification system...');\n    \n    // Test if Bootstrap is available\n    if (typeof bootstrap === 'undefined') {\n        console.error('Bootstrap is not loaded!');\n        return false;\n    }\n    \n    // Test CSRF token\n    const csrfToken = document.querySelector('meta[name=\"csrf-token\"]');\n    if (!csrfToken) {\n        console.error('CSRF token meta tag not found!');\n        return false;\n    }\n    \n    console.log('âœ… Bootstrap loaded:', typeof bootstrap);\n    console.log('âœ… CSRF token found:', csrfToken.getAttribute('content').substring(0, 10) + '...');\n    \n    return true;\n}\n\n// Global function for product cards\nwindow.notifyWhenAvailable = function(productId) {\n    console.log('notifyWhenAvailable called with productId:', productId);\n    \n    // Get product name from the card\n    let productName = 'this product';\n    try {\n        const productCard = document.querySelector(`[onclick*=\"notifyWhenAvailable(${productId})\"]`)?.closest('.product-card');\n        const titleElement = productCard?.querySelector('.product-title a');\n        if (titleElement) {\n            productName = titleElement.textContent.trim();\n        }\n    } catch (error) {\n        console.warn('Could not get product name:', error);\n    }\n    \n    console.log('Product name:', productName);\n    \n    // Show modal\n    showStockNotificationModal(productId, productName);\n};\n\n// Auto-run test when loaded\ndocument.addEventListener('DOMContentLoaded', function() {\n    console.log('DOM loaded, testing notification system...');\n    testNotificationSystem();\n});\n\nconsole.log('âœ… Stock Notification Debug System Loaded!');\n\n// Make test function globally available\nwindow.testNotificationSystem = testNotificationSystem;\nwindow.showStockNotificationModal = showStockNotificationModal;\n\nconsole.log('ðŸ”§ You can test the system by running: testNotificationSystem() in the console');\n