# Flash Offer Troubleshooting Guide\n\n## Issues Fixed:\n\n### 1. **Flash Offer Images Not Showing**\n- **Fixed**: Updated image URL generation to use `asset('storage/' . $flashOffer->banner_image)` instead of the accessor\n- **Fixed**: Added fallback content when banner image/title/description are empty\n- **Added**: Better error handling in the service provider\n\n### 2. **Flash Offer Popup Not Opening on Page Refresh**\n- **Fixed**: Updated service provider to use direct database query instead of scope method\n- **Fixed**: Added try-catch error handling to prevent service provider crashes\n- **Added**: Enhanced JavaScript debugging with console logs\n- **Added**: Debug mode for testing (`?debug=flash` in URL)\n\n## Debugging Steps:\n\n### Step 1: Run Troubleshooting Script\n```bash\n./debug_flash_offers.bat\n```\n\n### Step 2: Check Debug Page\nVisit: `http://greenvalleyherbs.local:8000/flash-offer-debug`\n\nThis page shows:\n- System status\n- Active flash offers\n- All flash offers in database\n- Storage link status\n- Quick action buttons\n\n### Step 3: Create Test Flash Offer\n1. Go to: `http://greenvalleyherbs.local:8000/admin/offers`\n2. Click \"Create New Offer\"\n3. Fill in basic details:\n   - **Name**: \"Test Flash Sale\"\n   - **Type**: \"Flash Offer\"\n   - **Discount Type**: \"Percentage\"\n   - **Value**: \"25\"\n   - **Start Date**: Today\n   - **End Date**: Tomorrow\n4. In Flash Offer Settings:\n   - ✅ Check \"Enable Flash Offer\"\n   - ✅ Check \"Show Popup Banner\"\n   - **Banner Title**: \"⚡ FLASH SALE! 25% OFF!\"\n   - **Banner Description**: \"Limited time offer!\"\n   - **Popup Delay**: \"3\" seconds\n   - ✅ Check \"Show Countdown Timer\"\n5. Upload a banner image (800x400px recommended)\n6. Save the offer\n\n### Step 4: Test the Popup\n1. Visit: `http://greenvalleyherbs.local:8000/shop`\n2. Wait 3 seconds for popup\n3. If no popup, try: `http://greenvalleyherbs.local:8000/shop?debug=flash`\n\n### Step 5: Clear Browser Storage (if needed)\n```javascript\n// Open browser console and run:\nlocalStorage.clear();\n// Or use the debug page \"Clear Storage\" button\n```\n\n## Common Issues & Solutions:\n\n### Issue: \"Storage link not working\"\n**Solution**:\n```bash\nphp artisan storage:link\n```\n\n### Issue: \"Images not showing\"\n**Checks**:\n1. Is `public/storage` folder present?\n2. Does the file exist in `storage/app/public/offers/banners/`?\n3. Are file permissions correct?\n\n### Issue: \"Popup not showing\"\n**Checks**:\n1. Is the offer active? (`is_active = 1`)\n2. Is flash offer enabled? (`is_flash_offer = 1`)\n3. Is popup enabled? (`show_popup = 1`)\n4. Are dates valid? (start_date <= today <= end_date)\n5. Has user seen popup today? (clear localStorage)\n\n### Issue: \"Service provider errors\"\n**Solution**: The service provider now has try-catch error handling\n\n## Debug URLs:\n\n- **Debug Page**: `http://greenvalleyherbs.local:8000/flash-offer-debug`\n- **Force Popup**: `http://greenvalleyherbs.local:8000/shop?debug=flash`\n- **Admin Offers**: `http://greenvalleyherbs.local:8000/admin/offers`\n\n## Browser Console Commands:\n\n```javascript\n// Check for flash offer data\nconsole.log('Flash Offer Debug Info');\n\n// Clear flash offer storage\nObject.keys(localStorage).forEach(key => {\n    if (key.startsWith('flash_offer_seen_')) {\n        localStorage.removeItem(key);\n    }\n});\n\n// Force show popup (if modal exists)\nif (document.getElementById('flashOfferModal')) {\n    const modal = new bootstrap.Modal(document.getElementById('flashOfferModal'));\n    modal.show();\n}\n```\n\n## Files Updated:\n\n1. **Service Provider**: `app/Providers/FlashOfferServiceProvider.php`\n   - Added error handling\n   - Fixed database query\n\n2. **Popup Component**: `resources/views/components/flash-offer-popup.blade.php`\n   - Fixed image URL generation\n   - Added fallback content\n   - Enhanced JavaScript debugging\n   - Added debug mode\n\n3. **Debug Tools**: \n   - `resources/views/flash-offer-debug.blade.php`\n   - `app/Http/Controllers/FlashOfferDebugController.php`\n   - `debug_flash_offers.bat`\n\n## Next Steps:\n\n1. Run `./debug_flash_offers.bat`\n2. Visit debug page to check system status\n3. Create a test flash offer if none exist\n4. Test popup functionality\n5. Check browser console for any JavaScript errors\n\nThe system should now work correctly with proper error handling and debugging capabilities!\n", "oldText": ""}]